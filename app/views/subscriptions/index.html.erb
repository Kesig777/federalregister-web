<div class="title"> 
  <span>My Subscriptions</span>
</div>

<%= content_tag(:div, flash[:notice], :class => 'flash notice')  if flash[:notice] %>
<%= content_tag(:div, flash[:error],  :class => 'flash error')   if flash[:error]  %>

<h2 class="subscription title">My Subscriptions</h2>
<%= render :partial => "subscriptions/subscription_metadata_bar", :locals => {:article_subscription_count => @article_subscription_count, :pi_subscription_count => @pi_subscription_count} %>

<div id="subscription-actions">
  <div id="subscription-type-filter">
    <ul>
      <script type="text/javascript">var subscription_type_filters = <%= @subscriptions.map{|s| s.type.underscore.dasherize}.uniq.to_json.html_safe %>;</script>
      <li class="sub_article first" data-filter-doc-type="article" data-filter-doc-type-display="Article">
        Article
      </li>
      <li class="sub_pi last" data-filter-doc-type="public-inspection-document" data-filter-doc-type-display="Public Inspection Document">
        Public Inspection
      </li>
    </ul>
  </div>
</div>

<ul id="subscriptions">
  <% @subscriptions.each do |subscription| %>
    <li data-subscription-id="<%= subscription.id %>" data-doc-type="<%= subscription.type.underscore.dasherize %>">
      <div class="subscription_type sub_<%= subscription.type.downcase %> add_tipsy"></div>

      <div class="search_data">
        <div class="title"><%= link_to subscription.mailing_list.title, subscription.search_path %></div>
        <dl class="metadata" id="col-1">
          <dt class="subscription_date">Subscription Started:</dt>
          <dd><%= subscription.subscribed_on %></dd>

          <dt class="pub_date">Last Delivered On:</dt>
          <dd><%= subscription.last_delivered_on %></dd>

          <dt class="pub_date">Delivery Count:</dt>
          <dd><%= subscription.delivery_count %></dd>
        </dl>
        <dl class="metadata" id="col-2">
          <% unless subscription.type == "PublicInspectionDocument" %>
            <dt class="activity">Weekly activity in last year:</dt>
            <dd><%= image_tag(subscription.sparkline_url, :alt => "Sparkline of weekly activity in last year.") %></dd>
          <% end %>
        </dl>
        <dl class="metadata" id="col-3">
        </dl>
      </div>

      <div class="subscription_data">
        <dl class="metadata">
          <dt class="<%= subscription.active? ? 'unsubscribe_link' : 'resubscribe_link' %>">Status:</dt>
          <% if subscription.active? %>
            <dd><span class='active'>active</span> : : <%= link_to "unsubscribe", subscription_path(subscription) , :class => 'unsubscribe' %></dd>
          <% else %>
            <dd><span class='inactive'>inactive</span> : : <%= link_to "resubscribe", confirm_subscription_path(subscription) , :class => 'resubscribe' %></dd>
          <% end %>
          <dt>Other Formats:</dt>
          <dd class="rss_link"><%= link_to "RSS", subscription.search_path(:format => ".rss", :order => :newest) %></dd>
          <dd class="csv_link"><%= link_to "Excel/CSV", subscription.search_path(:format => ".csv", :order => :newest) %></dd>
        </dl> 
      </div>
    </li>
  <% end %>
</ul>


