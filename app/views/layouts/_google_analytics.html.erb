<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-17607887-1" nonce="<%= content_security_policy_nonce %>"></script>
<script nonce="<%= content_security_policy_nonce %>">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('set', {
    'debug_mode': true,
    'page_title': 'Travel Destinations',
    'currency': 'USD',
    'agencies': 'Test Agency',
    'test_parameter': 'arbitrary content'
  });

  if (window.location.pathname == "/documents/search") {
    var queryString = window.location.search;
    var urlParams = new URLSearchParams(queryString)

    gtag('event', 'search_refinement', {
      'term':          urlParams.get('conditions[term]'),
      'agencies':      'parameter2_value',
      'document_type':
    });
  }

  <% if custom_page_to_track %>
    gtag('config', 'UA-17607887-1', {'page_location': custom_page_to_track, 'debug_mode': true, 'test_param': 'foobar', 'agencies': 'test agency'});
  <% else %>
    gtag('config', 'UA-17607887-1', {'debug_mode': true, 'test_param': 'arbitrary', 'agencies': 'test agency'});
  <% end %>
    gtag('event', 'fr_page_view', {
      'fr_page_path': window.location.pathname,
      'fr_page_referrer': document.referrer
    });
</script>

<% if Rails.env.production? %>
  <!-- We participate in the US government's analytics program. See the data at analytics.usa.gov. -->
  <script async type="text/javascript" nonce="<%= content_security_policy_nonce %>" src="https://dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=NARA&subagency=fedreg" id="_fed_an_ua_tag"></script>
<% end %>
