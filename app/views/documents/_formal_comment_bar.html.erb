<div id="comment-bar" class="document-notice-bar comment"
  data-document-number="<%= document.document_number %>"
  data-reggov-agency="<%= document.regulations_dot_gov_agency_id %>"
  data-reggov-comment-url="<%= document.comment_url %>"
  data-comments-close-on="<%= document.comments_close_on %>"
  data-comment-days-remaining="<%= document.comment_period_days_remaining %>"
  data-comment-period-open="<%= document.document_comment_period_open? %>"
  data-republished-document-comment-url="<%= document.republished_document_comment_url %>"
  data-reg-gov-participating-agency="<%= document.participating_agency? %>">
  <p>
    <%= fr_icon 'Chat' %>
    <% if document.document_comment_period_open? %>
      This document has a comment period that ends <%= document.comment_period_days_remaining %>.
      (<%= document.comments_close_on %>)
    <% else %>
      Comments on this document are being accepted at Regulations.gov.
    <% end %>

    <%= document.formal_comment_link %>
  </p>
</div>

<% if document.has_comments? %>

  <div class="reg-gov-comments-count">
    <% if Settings.feature_flags.multi_agency_comment_submission %>
      <%= link_to "#{document.comment_count} comments", "#", class: "deploy-comment-sidebar-js" %>
      received.  
      <% if document.regs_dot_gov_documents.select{|x| x.comment_count && x.comment_count > 0}.count > 1 %>
        <%= link_to "View posted comments", "#", class: "deploy-comment-sidebar-js" %>
      <% else%>
        <%= link_to "View posted comments", document.public_comments_url %>
      <% end %>
    <% else %>
      Read the
      <%= link_to pluralize(document.comment_count, 'public comment'),
        document.public_comments_url, target: '_blank' %>
      <%= fr_icon('info_circle', class: 'cj-tooltip', data: {tooltip: "#{I18n.t('comments.comment_count.explanation', last_updated: document.checked_regulationsdotgov_at.to_s(:datetime))}", 'tooltip-gravity': 'e' }) %>
    <% end %>
  </div>
<% end %>

<%= render partial: "comment_wrapper", locals: {document: document, multi_agency_comment_submission: Settings.feature_flags.multi_agency_comment_submission && (document.commentable_documents.count > 1)} %>
